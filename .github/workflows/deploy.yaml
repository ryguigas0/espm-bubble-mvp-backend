name: "Build and Deploy to Cloud Run"
run-name: ${{ github.actor }} is deploying to cloud artifact registry ðŸš€

on:
  push:

env:
  PROJECT_ID: "${{ secrets.GCP_PROJECT_ID }}"
  REGION: "${{ secrets.GCP_REGION }}"
  SERVICE: "${{ secrets.GCP_SERVICE }}"
  WORKLOAD_IDENTITY_PROVIDER: "${{ secrets.GCP_WORKLOAD_IDENTITY_PROVIDER }}"
  SERVICE_ACCOUNT: "${{ secrets.GCP_SERVICE_ACCOUNT }}"

jobs:
  deploy:
    runs-on: 'ubuntu-latest'
    permissions:
      contents: 'read'
      id-token: 'write'
    steps:
      - name: 'Checkout'
        uses: 'actions/checkout@692973e3d937129bcbf40652eb9f2f61becf3332' # actions/checkout@v4
      - id: 'auth'
        name: 'Authenticate to Google Cloud'
        uses: 'google-github-actions/auth@f112390a2df9932162083945e46d439060d66ec2' # google-github-actions/auth@v2
        with:
          project_id: '${{ env.PROJECT_ID }}'
          workload_identity_provider: '${{ env.WORKLOAD_IDENTITY_PROVIDER }}'
          service_account: '${{ env.SERVICE_ACCOUNT }}'
      # - name: 'Install Cloud SDK'
      #   uses: 'google-github-actions/setup-gcloud@v2'
      #   with:
      #     project_id: '${{ env.PROJECT_ID }}'
      #     version: '>= 363.0.0'
      # - name: 'Docker Auth'
      #   id: 'docker-auth'
      #   run: |-
      #     gcloud auth configure-docker ${{ env.REGION }}-docker.pkg.dev
      # # Tag forma: HOST-NAME/PROJECT-ID/REPOSITORY/IMAGE
      # - name: 'Build and push container'
      #   id: 'build-push-container'
      #   run: |-
      #     DOCKER_TAG="${{ env.REGION }}-docker.pkg.dev/${{ env.PROJECT_ID }}/${{ env.SERVICE }}/${{ env.SERVICE }}:${{ github.sha }}"
      #     docker build --tag "${DOCKER_TAG}" .
      #     docker push "${DOCKER_TAG}"